<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with CFtime • CFtime</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with CFtime">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CFtime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cftime.html">Working with CFtime</a></li>
    <li><a class="dropdown-item" href="../articles/conformance.html">Conformance with the CF Metadata Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/processing.html">Processing climate projection data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-CF/CFtime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with CFtime</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-CF/CFtime/blob/main/vignettes/articles/cftime.Rmd" class="external-link"><code>vignettes/articles/cftime.Rmd</code></a></small>
      <div class="d-none name"><code>cftime.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="climate-change-models-and-calendars">Climate change models and calendars<a class="anchor" aria-label="anchor" href="#climate-change-models-and-calendars"></a>
</h2>
<p>Around the world, many climate change models are being developed
(100+) under the umbrella of the <a href="https://www.wcrp-climate.org" class="external-link">World Climate Research Programme</a>
to assess the rate of climate change. Published data is generally
publicly available to download for research and other (non-commercial)
purposes through partner organizations in the Earth Systems Grid
Federation.</p>
<p>The data are all formatted to comply with the <a href="http://cfconventions.org" class="external-link">CF Metadata Conventions</a>, a set of
standards to support standardization among research groups and published
data sets. These conventions greatly facilitate use and analysis of the
climate projections because standard processing work flows (should) work
across the various data sets.</p>
<p>On the flip side, the CF Metadata Conventions needs to cater to a
wide range of modeling requirements and that means that some of the
areas covered by the standards are more complex than might be assumed.
One of those areas is the temporal dimension of the data sets. The CF
Metadata Conventions supports no less than 12 different calendar
definitions, that, upon analysis, fall into 9 distinct calendars (from
the perspective of computation of climate projections):</p>
<ul>
<li>
<code>standard</code> (or <code>gregorian</code>): The Gregorian
calendar that is in common use in many countries around the world,
adopted by edict of Pope Gregory XIII in 1582 and in effect from 15
October of that year. The earliest valid time in this calendar is
0001-01-01 00:00:00 (1 January of year 1) as year 0 does not exist and
the CF Metadata Conventions require the year to be positive, but noting
that a Julian calendar is used in periods before the Gregorian calendar
was introduced.</li>
<li>
<code>proleptic_gregorian</code>: This is the Gregorian calendar
with validity extended to periods prior to <code>1582-10-15</code>,
including a year 0 and negative years. This calendar is the closest to
what is being used in most OSes and what is being used by R. The
difference is in leap seconds: while this calendar does not account for
them (and neither does POSIXt), most computers are periodically
synchronized against a time server running on UTC, which does include
leap seconds.</li>
<li>
<code>tai</code>: International Atomic Time, a global standard for
linear time: it counts seconds since its start at 1958-01-01 00:00:00.
For presentation it uses the Gregorian calendar. Timestamps prior to its
start are not allowed.</li>
<li>
<code>utc</code>: Coordinated Universal Time, the standard for civil
timekeeping all over the world. It is based on International Atomic Time
but it uses occasional leap seconds to remain synchronous with Earth’s
rotation around the Sun; at the end of 2024 it is 37 seconds behind
<code>tai</code>. It uses the Gregorian calendar with a start at
1972-01-01 00:00:00; earlier timestamps are not allowed. Future
timestamps are also not allowed because the insertion of leap seconds is
unpredictable. Most computer clocks synchronize with UTC but calculate
time intervals without accounting for leap seconds.</li>
<li>
<code>julian</code>: Adopted in the year 45 BCE, every fourth year
is a leap year. Originally, the Julian calendar did not have a
monotonically increasing year assigned to it and there are indeed
several Julian calendars in use around the world today with different
years assigned to them. Common interpretation is currently that the year
is the same as that of the Gregorian calendar. The Julian calendar is
currently 13 days behind the Gregorian calendar. As with the standard
calendar, the earliest valid time in this calendar is 0001-01-01
00:00:00.</li>
<li>
<code>365_day</code> or <code>noleap</code>: “Model time” in which
no years have a leap day. Negative years are allowed and year 0
exists.</li>
<li>
<code>366_day</code> or <code>all_leap</code>: “Model time” in which
all years have a leap day. Negative years are allowed and year 0
exists.</li>
<li>
<code>360_day</code>: “Model time” in which every year has 12 months
of 30 days each. Negative years are allowed and year 0 exists.</li>
<li>
<code>none</code>: Perpetual “calendar” for experiments that are
simulated on a given instant during the year. All the elements in this
calendar thus represent the same instant in time.</li>
</ul>
<p>The three calendars of model time are specific to the CF Metadata
Conventions to reduce computational complexities of working with dates.
None of the nine calendars are compliant with the standard
<code>POSIXt</code> date/time facilities in <code>R</code> and using
standard date/time functions would quickly lead to problems. See the
section on “CFtime and POSIXt”, below, for a detailed description of the
discrepancies between the CF calendars and POSIXt.</p>
<p>In the below code snippet, the date of <code>1949-12-01</code> is the
<em>origin</em> from which other dates are calculated. When adding
43,289 days to this origin for a data set that uses the
<code>360_day</code> calendar, that should yield a date some 120 years
after the origin:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># POSIXt calculations on a standard calendar - INCORRECT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1949-12-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">43289</span></span>
<span><span class="co">#&gt; [1] "2068-06-08"</span></span>
<span></span>
<span><span class="co"># CFtime calculation on a "360_day" calendar - CORRECT</span></span>
<span><span class="co"># See below examples for details on the two functions</span></span>
<span><span class="fu"><a href="../reference/as_timestamp.html">as_timestamp</a></span><span class="op">(</span><span class="fu"><a href="../reference/CFtime-function.html">CFtime</a></span><span class="op">(</span><span class="st">"days since 1949-12-01"</span>, <span class="st">"360_day"</span>, <span class="fl">43289</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2070-02-30"</span></span></code></pre></div>
<p>Using standard <code>POSIXt</code> calculations gives a result that
is about 21 months off from the correct date - obviously an undesirable
situation. This example is far from artificial: <code>1949-12-01</code>
is the origin for all CORDEX data, covering the period 1950 - 2005 for
historical experiments and the period 2006 - 2100 for RCP experiments
(with some deviation between data sets), and several models used in the
CORDEX set use the <code>360_day</code> calendar. The
<code>365_day</code> or <code>noleap</code> calendar deviates by about 1
day every 4 years (disregarding centurial years), or about 24 days in a
century. The <code>366_day</code> or <code>all_leap</code> calendar
deviates by about 3 days every 4 years, or about 76 days in a
century.</p>
<p>The <code>CFtime</code> package deals with the complexity of the
different calendars allowed by the CF Metadata Conventions. It properly
formats dates and times (even oddball dates like
<code>2070-02-30</code>) and it can generate calendar-aware factors for
further processing of the data.</p>
<div class="section level5">
<h5 id="time-zones">Time zones<a class="anchor" aria-label="anchor" href="#time-zones"></a>
</h5>
<p>The character of CF time series - a number of numerical offsets from
a base date - implies that there should only be a single time zone
associated with the time series, and then only for the
<code>standard</code> and <code>proleptic_gregorian</code> calendars.
For the other calendars a time zone can be set but it will have no
effect. Daylight savings time information is never considered by
<code>CFtime</code> so the user should take care to avoid entering times
with DST; DST should be accounted for by indicating the applicable DST
time zone.</p>
<p>The time zone offset from UTC is stored in the <code>CFTime</code>
instance and can be retrieved with the <code><a href="../reference/properties.html">timezone()</a></code> function.
If a vector of character timestamps with time zone information is parsed
with the <code><a href="../reference/parse_timestamps.html">parse_timestamps()</a></code> function and the time zones are
found to be different from the <code>CFTime</code> time zone, a warning
message is generated but the timestamp is interpreted as being in the
<code>CFTime</code> time zone. No correction of timestamp to
<code>CFTime</code> time zone is performed.</p>
<p>The concept of time zones does not apply to the <code>utc</code> and
<code>tai</code> calendars as they represent universal time, i.e. the
indicated time is valid all over the globe. Timestamps passed to these
calendars should not have a time zone indicated, but if there are,
anything other than a 0 offset will generate an error.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-cftime-to-deal-with-calendars">Using CFtime to deal with calendars<a class="anchor" aria-label="anchor" href="#using-cftime-to-deal-with-calendars"></a>
</h2>
<p>Data sets that are compliant with the CF Metadata Conventions always
include a <em>origin</em>, a specific point in time in reference to a
specified <em>calendar</em>, from which other points in time are
calculated by adding a specified <em>offset</em> of a certain
<em>unit</em>. This approach is encapsulated in the <code>CFtime</code>
package by the R6 class <code>CFTime</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a CFTime object from a definition string, a calendar and some offsets</span></span>
<span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CFtime-function.html">CFtime</a></span><span class="op">(</span><span class="st">"days since 1949-12-01"</span>, <span class="st">"360_day"</span>, <span class="fl">19830</span><span class="op">:</span><span class="fl">90029</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; CF calendar:</span></span>
<span><span class="co">#&gt;   Origin  : 1949-12-01T00:00:00</span></span>
<span><span class="co">#&gt;   Units   : days</span></span>
<span><span class="co">#&gt;   Type    : 360_day</span></span>
<span><span class="co">#&gt; Time series:</span></span>
<span><span class="co">#&gt;   Elements: [2005-01-01 .. 2199-12-30] (average of 1.000000 days between 70200 elements)</span></span>
<span><span class="co">#&gt;   Bounds  : not set</span></span></code></pre></div>
<p>The <code><a href="../reference/CFtime-function.html">CFtime()</a></code> function takes a description (which is
actually a unit - “days” - in reference to an origin - “1949-12-01”), a
calendar description, and a vector of <em>offsets</em> from that origin.
Once a <code>CFTime</code> instance is created its origin and calendar
cannot be changed anymore. Offsets may be added.</p>
<p>In practice, these parameters will be taken from the data set of
interest. CF Metadata Conventions require data sets to be in the netCDF
format, with all metadata describing the data set included in a single
file, including the mandatory “Conventions” global attribute which
should have a string identifying the version of the CF Metadata
Conventions that this file adheres to (among possible others). Not
surprisingly, all the pieces of interest are contained in the “time”
coordinate variables of the file. The process then becomes as follows,
for a CMIP6 file of daily precipitation.</p>
<blockquote>
<p>In this vignette we are using the <a href="https://cran.r-project.org/package=ncdfCF" class="external-link"><code>ncdfCF</code>
package</a> as that provides the easiest interface to work with netCDF
files. Package <code>CFtime</code> is integrated into
<code>ncdfCF</code> which makes working with time dimensions in netCDF
seamless.<br>
Packages <code>RNetCDF</code> and <code>ncdf4</code> can work with
<code>CFtime</code> as well but then the “intelligence” built into
<code>ncdfCF</code> is not available, such as automatically identifying
axes and data orientation. Other packages like <code>terra</code> and
<code>stars</code> are not recommended because they do not provide
access to the specifics of the time dimension of the data and do not
consider any calendars other than “proleptic_gregorian”.</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("ncdfCF")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-CF/ncdfCF" class="external-link">ncdfCF</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Opening a data file that is included with the package.</span></span>
<span><span class="co"># Usually you would `list.files()` on a directory of your choice.</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"CFtime"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">(</span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">ncdfCF</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ncdfCF/man/open_ncdf.html" class="external-link">open_ncdf</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Dataset&gt; pr_day_GFDL-ESM4_ssp245_r1i1p1f1_gr1_20150101-20991231_v20180701 </span></span>
<span><span class="co">#&gt; Resource   : /home/runner/work/_temp/Library/CFtime/extdata/pr_day_GFDL-ESM4_ssp245_r1i1p1f1_gr1_20150101-20991231_v20180701.nc </span></span>
<span><span class="co">#&gt; Format     : netcdf4 </span></span>
<span><span class="co">#&gt; Collection : CMIP6 </span></span>
<span><span class="co">#&gt; Conventions: CF-1.7 CMIP-6.0 UGRID-1.0 </span></span>
<span><span class="co">#&gt; Has groups : FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable:</span></span>
<span><span class="co">#&gt;  name long_name     units      data_type axes          </span></span>
<span><span class="co">#&gt;  pr   Precipitation kg m-2 s-1 NC_FLOAT  lon, lat, time</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; External variable: areacella</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name                  type      length</span></span>
<span><span class="co">#&gt;  external_variables    NC_CHAR     9   </span></span>
<span><span class="co">#&gt;  history               NC_CHAR   124   </span></span>
<span><span class="co">#&gt;  table_id              NC_CHAR     3   </span></span>
<span><span class="co">#&gt;  activity_id           NC_CHAR    11   </span></span>
<span><span class="co">#&gt;  branch_method         NC_CHAR     8   </span></span>
<span><span class="co">#&gt;  branch_time_in_child  NC_DOUBLE   1   </span></span>
<span><span class="co">#&gt;  branch_time_in_parent NC_DOUBLE   1   </span></span>
<span><span class="co">#&gt;  comment               NC_CHAR    10   </span></span>
<span><span class="co">#&gt;  contact               NC_CHAR    32   </span></span>
<span><span class="co">#&gt;  Conventions           NC_CHAR    25   </span></span>
<span><span class="co">#&gt;  creation_date         NC_CHAR    20   </span></span>
<span><span class="co">#&gt;  data_specs_version    NC_CHAR     8   </span></span>
<span><span class="co">#&gt;  experiment            NC_CHAR    30   </span></span>
<span><span class="co">#&gt;  experiment_id         NC_CHAR     6   </span></span>
<span><span class="co">#&gt;  forcing_index         NC_INT      1   </span></span>
<span><span class="co">#&gt;  frequency             NC_CHAR     3   </span></span>
<span><span class="co">#&gt;  further_info_url      NC_CHAR    77   </span></span>
<span><span class="co">#&gt;  grid                  NC_CHAR    94   </span></span>
<span><span class="co">#&gt;  grid_label            NC_CHAR     3   </span></span>
<span><span class="co">#&gt;  initialization_index  NC_INT      1   </span></span>
<span><span class="co">#&gt;  institution           NC_CHAR   112   </span></span>
<span><span class="co">#&gt;  institution_id        NC_CHAR     9   </span></span>
<span><span class="co">#&gt;  license               NC_CHAR   805   </span></span>
<span><span class="co">#&gt;  mip_era               NC_CHAR     5   </span></span>
<span><span class="co">#&gt;  nominal_resolution    NC_CHAR     6   </span></span>
<span><span class="co">#&gt;  parent_activity_id    NC_CHAR     4   </span></span>
<span><span class="co">#&gt;  parent_experiment_id  NC_CHAR    10   </span></span>
<span><span class="co">#&gt;  parent_mip_era        NC_CHAR     5   </span></span>
<span><span class="co">#&gt;  parent_source_id      NC_CHAR     9   </span></span>
<span><span class="co">#&gt;  parent_time_units     NC_CHAR    19   </span></span>
<span><span class="co">#&gt;  parent_variant_label  NC_CHAR     8   </span></span>
<span><span class="co">#&gt;  physics_index         NC_INT      1   </span></span>
<span><span class="co">#&gt;  product               NC_CHAR    12   </span></span>
<span><span class="co">#&gt;  realization_index     NC_INT      1   </span></span>
<span><span class="co">#&gt;  realm                 NC_CHAR     5   </span></span>
<span><span class="co">#&gt;  source                NC_CHAR   560   </span></span>
<span><span class="co">#&gt;  source_id             NC_CHAR     9   </span></span>
<span><span class="co">#&gt;  source_type           NC_CHAR    18   </span></span>
<span><span class="co">#&gt;  sub_experiment        NC_CHAR     4   </span></span>
<span><span class="co">#&gt;  sub_experiment_id     NC_CHAR     4   </span></span>
<span><span class="co">#&gt;  title                 NC_CHAR    82   </span></span>
<span><span class="co">#&gt;  tracking_id           NC_CHAR    49   </span></span>
<span><span class="co">#&gt;  variable_id           NC_CHAR     2   </span></span>
<span><span class="co">#&gt;  variant_info          NC_CHAR     3   </span></span>
<span><span class="co">#&gt;  references            NC_CHAR    30   </span></span>
<span><span class="co">#&gt;  variant_label         NC_CHAR     8   </span></span>
<span><span class="co">#&gt;  value                                              </span></span>
<span><span class="co">#&gt;  areacella                                          </span></span>
<span><span class="co">#&gt;  File was processed by fremetar (GFDL analog of ... </span></span>
<span><span class="co">#&gt;  day                                                </span></span>
<span><span class="co">#&gt;  ScenarioMIP                                        </span></span>
<span><span class="co">#&gt;  standard                                           </span></span>
<span><span class="co">#&gt;  60225                                              </span></span>
<span><span class="co">#&gt;  60225                                              </span></span>
<span><span class="co">#&gt;  &lt;null ref&gt;                                         </span></span>
<span><span class="co">#&gt;  gfdl.climate.model.info@noaa.gov                   </span></span>
<span><span class="co">#&gt;  CF-1.7 CMIP-6.0 UGRID-1.0                          </span></span>
<span><span class="co">#&gt;  2019-06-18T05:29:00Z                               </span></span>
<span><span class="co">#&gt;  01.00.27                                           </span></span>
<span><span class="co">#&gt;  update of RCP4.5 based on SSP2                     </span></span>
<span><span class="co">#&gt;  ssp245                                             </span></span>
<span><span class="co">#&gt;  1                                                  </span></span>
<span><span class="co">#&gt;  day                                                </span></span>
<span><span class="co">#&gt;  https://furtherinfo.es-doc.org/CMIP6.NOAA-GFDL.... </span></span>
<span><span class="co">#&gt;  atmos data regridded from Cubed-sphere (c96) to... </span></span>
<span><span class="co">#&gt;  gr1                                                </span></span>
<span><span class="co">#&gt;  1                                                  </span></span>
<span><span class="co">#&gt;  National Oceanic and Atmospheric Administration... </span></span>
<span><span class="co">#&gt;  NOAA-GFDL                                          </span></span>
<span><span class="co">#&gt;  CMIP6 model data produced by NOAA-GFDL is licen... </span></span>
<span><span class="co">#&gt;  CMIP6                                              </span></span>
<span><span class="co">#&gt;  100 km                                             </span></span>
<span><span class="co">#&gt;  CMIP                                               </span></span>
<span><span class="co">#&gt;  historical                                         </span></span>
<span><span class="co">#&gt;  CMIP6                                              </span></span>
<span><span class="co">#&gt;  GFDL-ESM4                                          </span></span>
<span><span class="co">#&gt;  days since 1850-1-1                                </span></span>
<span><span class="co">#&gt;  r1i1p1f1                                           </span></span>
<span><span class="co">#&gt;  1                                                  </span></span>
<span><span class="co">#&gt;  model-output                                       </span></span>
<span><span class="co">#&gt;  1                                                  </span></span>
<span><span class="co">#&gt;  atmos                                              </span></span>
<span><span class="co">#&gt;  GFDL-ESM4 (2018):\natmos: GFDL-AM4.1 (Cubed-sphe...</span></span>
<span><span class="co">#&gt;  GFDL-ESM4                                          </span></span>
<span><span class="co">#&gt;  AOGCM AER CHEM BGC                                 </span></span>
<span><span class="co">#&gt;  none                                               </span></span>
<span><span class="co">#&gt;  none                                               </span></span>
<span><span class="co">#&gt;  NOAA GFDL GFDL-ESM4 model output prepared for C... </span></span>
<span><span class="co">#&gt;  hdl:21.14100/48767401-8960-4864-8738-e64640bef71d  </span></span>
<span><span class="co">#&gt;  pr                                                 </span></span>
<span><span class="co">#&gt;  N/A                                                </span></span>
<span><span class="co">#&gt;  see further_info_url attribute                     </span></span>
<span><span class="co">#&gt;  r1i1p1f1</span></span>
<span></span>
<span><span class="co"># "Conventions" global attribute must have a string like "CF-1.*" for this package to work reliably</span></span>
<span></span>
<span><span class="co"># Look at the "time" axis</span></span>
<span><span class="op">(</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Time axis&gt; [6] time</span></span>
<span><span class="co">#&gt; Length     : 31025</span></span>
<span><span class="co">#&gt; Axis       : T </span></span>
<span><span class="co">#&gt; Calendar   : noleap </span></span>
<span><span class="co">#&gt; Range      : 2015-01-01T12:00:00 ... 2099-12-31T12:00:00 (days) </span></span>
<span><span class="co">#&gt; Bounds     : 2015-01-01 ... 2100-01-01 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name          type      length value                </span></span>
<span><span class="co">#&gt;  long_name     NC_CHAR    4     time                 </span></span>
<span><span class="co">#&gt;  axis          NC_CHAR    1     T                    </span></span>
<span><span class="co">#&gt;  calendar_type NC_CHAR    6     noleap               </span></span>
<span><span class="co">#&gt;  bounds        NC_CHAR    9     time_bnds            </span></span>
<span><span class="co">#&gt;  standard_name NC_CHAR    4     time                 </span></span>
<span><span class="co">#&gt;  description   NC_CHAR   13     Temporal mean        </span></span>
<span><span class="co">#&gt;  units         NC_CHAR   21     days since 1850-01-01</span></span>
<span><span class="co">#&gt;  calendar      NC_CHAR    6     noleap               </span></span>
<span><span class="co">#&gt;  actual_range  NC_DOUBLE  2     60225.5, 91249.5</span></span>
<span></span>
<span><span class="co"># Get the CFTime instance from the "time" axis</span></span>
<span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="co">#&gt; CF calendar:</span></span>
<span><span class="co">#&gt;   Origin  : 1850-01-01T00:00:00</span></span>
<span><span class="co">#&gt;   Units   : days</span></span>
<span><span class="co">#&gt;   Type    : noleap</span></span>
<span><span class="co">#&gt; Time series:</span></span>
<span><span class="co">#&gt;   Elements: [2015-01-01T12:00:00 .. 2099-12-31T12:00:00] (average of 1.000000 days between 31025 elements)</span></span>
<span><span class="co">#&gt;   Bounds  : set</span></span></code></pre></div>
<p>You can see from the global attribute “Conventions” that the file
adheres to the CF Metadata Conventions, among others. According to the
CF conventions, <code>units</code> and <code>calendar</code> are
required attributes of the “time” dimension in the netCDF file.</p>
<p>The above example (and others in this vignette) use the
<code>ncdfCF</code> package. If you are using the <code>RNetCDF</code>
or <code>ncdf4</code> package, checking for CF conventions and then
creating a <code>CFTime</code> instance goes like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mjwoods/RNetCDF" class="external-link">RNetCDF</a></span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/open.nc.html" class="external-link">open.nc</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/att.get.nc.html" class="external-link">att.get.nc</a></span><span class="op">(</span><span class="va">nc</span>, <span class="op">-</span><span class="fl">1</span>, <span class="st">"Conventions"</span><span class="op">)</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CFtime-function.html">CFtime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/att.get.nc.html" class="external-link">att.get.nc</a></span><span class="op">(</span><span class="va">nc</span>, <span class="st">"time"</span>, <span class="st">"units"</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/att.get.nc.html" class="external-link">att.get.nc</a></span><span class="op">(</span><span class="va">nc</span>, <span class="st">"time"</span>, <span class="st">"calendar"</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/RNetCDF/man/var.get.nc.html" class="external-link">var.get.nc</a></span><span class="op">(</span><span class="va">nc</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">ncdf4</a></span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">nc_open</span><span class="op">(</span><span class="va">fn</span><span class="op">)</span></span>
<span><span class="fu">nc_att_get</span><span class="op">(</span><span class="va">nc</span>, <span class="fl">0</span>, <span class="st">"Conventions"</span><span class="op">)</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CFtime-function.html">CFtime</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">time</span><span class="op">$</span><span class="va">units</span>, </span>
<span>            <span class="va">nc</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">time</span><span class="op">$</span><span class="va">calendar</span>, </span>
<span>            <span class="va">nc</span><span class="op">$</span><span class="va">dim</span><span class="op">$</span><span class="va">time</span><span class="op">$</span><span class="va">vals</span><span class="op">)</span></span></code></pre></div>
<p>The character representations of the time series can be easily
generated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">as_timestamp</span><span class="op">(</span>format <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="va">dates</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "2015-01-01" "2015-01-02" "2015-01-03" "2015-01-04" "2015-01-05"</span></span>
<span><span class="co">#&gt;  [6] "2015-01-06" "2015-01-07" "2015-01-08" "2015-01-09" "2015-01-10"</span></span></code></pre></div>
<p>…as well as the range of the time series:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span><span class="op">$</span><span class="fu">range</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2015-01-01T12:00:00" "2099-12-31T12:00:00"</span></span></code></pre></div>
<p>Note that in this latter case, if any of the timestamps in the time
series have a time that is other than <code>00:00:00</code> then the
time of the extremes of the time series is also displayed. This is a
common occurrence because the CF Metadata Conventions prescribe that the
middle of the time period (month, day, etc) is recorded, which for
months with 31 days would be something like
<code>2005-01-15T12:00:00</code>.</p>
</div>
<div class="section level2">
<h2 id="supporting-processing-of-climate-projection-data">Supporting processing of climate projection data<a class="anchor" aria-label="anchor" href="#supporting-processing-of-climate-projection-data"></a>
</h2>
<p>When working with high resolution climate projection data, typically
at a “day” resolution, one of the processing steps would be to aggregate
the data to some lower resolution such as a dekad (10-day period), a
month or a meteorological season, and then compute a derivative value
such as the dekadal sum of precipitation, monthly minimum/maximum daily
temperature, or seasonal average daily short-wave irradiance.</p>
<p>It is also possible to create factors for multiple “eras” in one go.
This greatly reduces programming effort if you want to calculate
anomalies over multiple future periods. A complete example is provided
in the vignette <a href="Processing.html">“Processing climate projection
data”</a>.</p>
<p>It is easy to generate the factors that you need once you have a
<code>CFTime</code> instance prepared:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dekad factor for the whole `t` time series that was created above</span></span>
<span><span class="va">f_k</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">factor</span><span class="op">(</span><span class="st">"dekad"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">f_k</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Factor w/ 3060 levels "2015D01","2015D02",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "era")= int -1</span></span>
<span><span class="co">#&gt;  - attr(*, "period")= chr "dekad"</span></span>
<span><span class="co">#&gt;  - attr(*, "CFTime")=CFTime with origin [days since 1850-01-01] using calendar [noleap] having 3060 offset values</span></span>
<span></span>
<span><span class="co"># Create monthly factors for a baseline era and early, mid and late 21st century eras</span></span>
<span><span class="va">baseline</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">factor</span><span class="op">(</span>era <span class="op">=</span> <span class="fl">1991</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span></span>
<span><span class="va">future</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">factor</span><span class="op">(</span>era <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>early <span class="op">=</span> <span class="fl">2021</span><span class="op">:</span><span class="fl">2040</span>, mid <span class="op">=</span> <span class="fl">2041</span><span class="op">:</span><span class="fl">2060</span>, late <span class="op">=</span> <span class="fl">2061</span><span class="op">:</span><span class="fl">2080</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">future</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ early: Factor w/ 12 levels "01","02","03",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "era")= int 20</span></span>
<span><span class="co">#&gt;   ..- attr(*, "period")= chr "month"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "CFTime")=CFClimatology with origin [days since 1850-01-01] using calendar [noleap] having 12 offset values $ mid  : Factor w/ 12 levels "01","02","03",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "era")= int 20</span></span>
<span><span class="co">#&gt;   ..- attr(*, "period")= chr "month"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "CFTime")=CFClimatology with origin [days since 1850-01-01] using calendar [noleap] having 12 offset values $ late : Factor w/ 12 levels "01","02","03",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "era")= int 20</span></span>
<span><span class="co">#&gt;   ..- attr(*, "period")= chr "month"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "CFTime")=CFClimatology with origin [days since 1850-01-01] using calendar [noleap] having 12 offset values</span></span></code></pre></div>
<p>For the “era” version, there are two interesting things to note
here:</p>
<ul>
<li>The eras do not have to coincide with the boundaries of the time
series. In the example above, the time series starts in 2015, while the
baseline era is from 1991. Obviously, the number of time steps from the
time series that then fall within this era will then be reduced.</li>
<li>The factor is always of the same length as the time series, with
<code>NA</code> values where the time series values are not falling in
the era. This ensures that the factor is compatible with the data set
which the time series describes, such that functions like
<code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply()</a></code> will not throw an error.</li>
</ul>
<p>There are six periods defined for factoring:</p>
<ul>
<li>
<code>year</code>, to summarize data to yearly timescales</li>
<li>
<code>season</code>, the meteorological seasons. Note that the month
of December will be added to the months of January and February of the
following year, so the date “2020-12-01” yields the factor value
“2021S1”.</li>
<li>
<code>quarter</code>, the standard quarters of the year.</li>
<li>
<code>month</code>, monthly summaries, the default period.</li>
<li>
<code>dekad</code>, 10-day period. Each month is subdivided in
dekads as follows: (1) days 01 - 10; (2) days 11 - 20; (3) remainder of
the month.</li>
<li>
<code>day</code>, to summarize sub-daily data.</li>
</ul>
<div class="section level5">
<h5 id="new-time-dimension">New “time” dimension<a class="anchor" aria-label="anchor" href="#new-time-dimension"></a>
</h5>
<p>A <code>CFTime</code> instance describes the “time” dimension of an
associated data set. When you process that dimension of the data set
using <code>CFTime$factor()</code> or another method to filter or
otherwise subset the “time” dimension, the resulting data set will have
a different “time” dimension. To associate a proper <code>CFTime</code>
instance with your processing result, the methods in this package return
that <code>CFTime</code> instance as an attribute:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="op">(</span><span class="va">new_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">f_k</span>, <span class="st">"CFTime"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; CF calendar:</span></span>
<span><span class="co">#&gt;   Origin  : 1850-01-01T00:00:00</span></span>
<span><span class="co">#&gt;   Units   : days</span></span>
<span><span class="co">#&gt;   Type    : noleap</span></span>
<span><span class="co">#&gt; Time series:</span></span>
<span><span class="co">#&gt;   Elements: [2015-01-06T00:00:00 .. 2099-12-26T12:00:00] (average of 10.138771 days between 3060 elements)</span></span>
<span><span class="co">#&gt;   Bounds  : set</span></span></code></pre></div>
<p>In the vignette <a href="Processing.html">“Processing climate
projection data”</a> is a fully worked out example of this.</p>
</div>
<div class="section level5">
<h5 id="incomplete-time-series">Incomplete time series<a class="anchor" aria-label="anchor" href="#incomplete-time-series"></a>
</h5>
<p>You can test if your time series is complete with the function
<code><a href="../reference/is_complete.html">is_complete()</a></code>. A time series is considered complete if the
time steps between the two extreme values are equally spaced. There is a
“fuzzy” assessment of completeness for time series with a datum unit of
“days” or smaller where the time steps are months or years apart - these
have different lengths in days in different months or years (e.g. a leap
year).</p>
<p>If your time series is incomplete, for instance because it has
missing time steps, you should recognize that in your further
processing. As an example, you might want to filter out months that have
fewer than 90% of daily data from further processing or apply weights
based on the actual coverage.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Is the time series complete?</span></span>
<span><span class="fu"><a href="../reference/is_complete.html">is_complete</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># How many time units fit in a factor level?</span></span>
<span><span class="va">t</span><span class="op">$</span><span class="fu">factor_units</span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 31 28 31 30 31 30 31 31 30 31 30 31</span></span>
<span></span>
<span><span class="co"># What's the absolute and relative coverage of our time series</span></span>
<span><span class="va">t</span><span class="op">$</span><span class="fu">factor_coverage</span><span class="op">(</span><span class="va">baseline</span>, <span class="st">"absolute"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 186 168 186 180 186 180 186 186 180 186 180 186</span></span>
<span><span class="va">t</span><span class="op">$</span><span class="fu">factor_coverage</span><span class="op">(</span><span class="va">baseline</span>, <span class="st">"relative"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2</span></span></code></pre></div>
<p>The time series is complete but coverage of the baseline era is only
20%! Recall that the time series starts in 2015 while the baseline
period in the factor is for <code>1991:2020</code> so that’s only 6
years of time series data out of 30 years of the baseline factor.</p>
<p>An artificial example of missing data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 4 years of data on a `365_day` calendar, keep 80% of values</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">4</span></span>
<span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">offsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">n</span> <span class="op">*</span> <span class="va">cov</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CFtime-function.html">CFtime</a></span><span class="op">(</span><span class="st">"days since 2020-01-01"</span>, <span class="st">"365_day"</span>, <span class="va">offsets</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Offsets not monotonically increasing.</span></span>
<span><span class="co">#&gt; CF calendar:</span></span>
<span><span class="co">#&gt;   Origin  : 2020-01-01T00:00:00</span></span>
<span><span class="co">#&gt;   Units   : days</span></span>
<span><span class="co">#&gt;   Type    : 365_day</span></span>
<span><span class="co">#&gt; Time series:</span></span>
<span><span class="co">#&gt;   Elements: [2020-01-04 .. 2023-12-31] (average of 1.247644 days between 1168 elements)</span></span>
<span><span class="co">#&gt;   Bounds  : not set</span></span>
<span><span class="co"># Note that there are about 1.25 days between observations</span></span>
<span></span>
<span><span class="va">mon</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">factor</span><span class="op">(</span><span class="st">"month"</span><span class="op">)</span></span>
<span><span class="va">t</span><span class="op">$</span><span class="fu">factor_coverage</span><span class="op">(</span><span class="va">mon</span>, <span class="st">"absolute"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 26 24 26 26 23 24 24 22 23 22 24 26 24 21 21 25 25 26 21 26 26 26 22 23 23</span></span>
<span><span class="co">#&gt; [26] 23 25 22 24 25 23 28 25 25 24 22 21 22 26 29 23 26 26 27 23 26 27 27</span></span>
<span><span class="va">t</span><span class="op">$</span><span class="fu">factor_coverage</span><span class="op">(</span><span class="va">mon</span>, <span class="st">"relative"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.8387097 0.8571429 0.8387097 0.8666667 0.7419355 0.8000000 0.7741935</span></span>
<span><span class="co">#&gt;  [8] 0.7096774 0.7666667 0.7096774 0.8000000 0.8387097 0.7741935 0.7500000</span></span>
<span><span class="co">#&gt; [15] 0.6774194 0.8333333 0.8064516 0.8666667 0.6774194 0.8387097 0.8666667</span></span>
<span><span class="co">#&gt; [22] 0.8387097 0.7333333 0.7419355 0.7419355 0.8214286 0.8064516 0.7333333</span></span>
<span><span class="co">#&gt; [29] 0.7741935 0.8333333 0.7419355 0.9032258 0.8333333 0.8064516 0.8000000</span></span>
<span><span class="co">#&gt; [36] 0.7096774 0.6774194 0.7857143 0.8387097 0.9666667 0.7419355 0.8666667</span></span>
<span><span class="co">#&gt; [43] 0.8387097 0.8709677 0.7666667 0.8387097 0.9000000 0.8709677</span></span></code></pre></div>
<p>Keep in mind, though, that there are data sets where the time unit is
lower than the intended resolution of the data. Since the CF conventions
recommend that the coarsest time unit is “day”, many files with monthly
data sets have a definition like <code>days since 2016-01-01</code> with
offset values for the middle of the month like
<code>15, 44, 74, 104, ...</code>. Even in these scenarios you can
verify that your data set is complete with the function
<code>CFcomplete()</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="cftime-and-posixt">CFtime and POSIXt<a class="anchor" aria-label="anchor" href="#cftime-and-posixt"></a>
</h2>
<p>The CF Metadata Conventions supports 11 different calendars
(disregarding <code>none</code> here). None of these are fully
compatible with POSIXt, the basis for timekeeping on virtually all
computers. The reason for this is that POSIXt does not consider leap
seconds (just like the <code>tai</code> calendar) but computer clocks
are periodically synchronized using Network Time Protocol servers that
report UTC time. The problem is easily demonstrated:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1972-01-01 is the origin of UTC, when leap seconds came into existence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"1972-01-01"</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"sec"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time difference of 1640995200 secs</span></span>
<span></span>
<span><span class="co"># CFtime with a "utc" calendar</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CFtime.html">CFTime</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"seconds since 1972-01-01"</span>, <span class="st">"utc"</span>, <span class="st">"2024-01-01"</span><span class="op">)</span></span>
<span><span class="va">t</span><span class="op">$</span><span class="va">offsets</span></span>
<span><span class="co">#&gt; [1] 1640995227</span></span>
<span></span>
<span><span class="co"># Leap seconds in UTC</span></span>
<span><span class="va">.leap.seconds</span></span>
<span><span class="co">#&gt;  [1] "1972-07-01 GMT" "1973-01-01 GMT" "1974-01-01 GMT" "1975-01-01 GMT"</span></span>
<span><span class="co">#&gt;  [5] "1976-01-01 GMT" "1977-01-01 GMT" "1978-01-01 GMT" "1979-01-01 GMT"</span></span>
<span><span class="co">#&gt;  [9] "1980-01-01 GMT" "1981-07-01 GMT" "1982-07-01 GMT" "1983-07-01 GMT"</span></span>
<span><span class="co">#&gt; [13] "1985-07-01 GMT" "1988-01-01 GMT" "1990-01-01 GMT" "1991-01-01 GMT"</span></span>
<span><span class="co">#&gt; [17] "1992-07-01 GMT" "1993-07-01 GMT" "1994-07-01 GMT" "1996-01-01 GMT"</span></span>
<span><span class="co">#&gt; [21] "1997-07-01 GMT" "1999-01-01 GMT" "2006-01-01 GMT" "2009-01-01 GMT"</span></span>
<span><span class="co">#&gt; [25] "2012-07-01 GMT" "2015-07-01 GMT" "2017-01-01 GMT"</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime()</a></code> is off by 27 seconds, the number of leap
seconds in UTC since their introduction in 1972. Your computer may have
the correct time based on UTC, but calculations over periods that
include leap seconds are always off by a number of seconds.</p>
<div class="section level5">
<h5 id="duh">Duh!<a class="anchor" aria-label="anchor" href="#duh"></a>
</h5>
<p>If 27 seconds is of no concern to you or your application - perhaps
your data has a daily resolution - then you can safely forget about the
leap seconds in several of the calendars, in particular
<code>standard</code> (for periods after 1582-10-15),
<code>proleptic_gregorian</code> and <code>tai</code>. The
<code>utc</code> calendar does account for leap seconds so consider if
you should use that - this is the only calendar that considers leap
seconds in calculation. These calendars support the generation of
timestamps in POSIXct with the <code><a href="../reference/as_timestamp.html">as_timestamp()</a></code> function but
note the potential for a discrepancy due to the presence of leap
seconds.</p>
</div>
<div class="section level5">
<h5 id="when-seconds-count">When seconds count<a class="anchor" aria-label="anchor" href="#when-seconds-count"></a>
</h5>
<p>If second accuracy is of concern, then you should carefully consider
the time keeping in the source of your data and use a matching calendar.
The <code>utc</code> calendar is a sensible option if your equipment
synchronizes time with an NTP server or a computer that does so. Even
then you should ensure that time is accurate before your first new
observation after a new leap second is introduced.</p>
</div>
<div class="section level5">
<h5 id="bigger-problems">Bigger problems<a class="anchor" aria-label="anchor" href="#bigger-problems"></a>
</h5>
<p>The other calendars have discrepancies with POSIXt that are much
larger, namely one or more days. These calendars do not support POSIXct
timestamps and an error will be thrown if you try. If you really want
the timestamps in POSIXct then you can generate the timestamps as
character strings using this package, and then convert to a
<code>POSIXct</code> or <code>Date</code> using the available R tools.
Converting time series using these incompatible calendars to
<code>POSIXct</code> or <code>Date</code> is likely to produce problems.
This is most pronounced for the <code>360_day</code> calendar:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Days in January and February</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CFtime-function.html">CFtime</a></span><span class="op">(</span><span class="st">"days since 2023-01-01"</span>, <span class="st">"360_day"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">59</span><span class="op">)</span></span>
<span><span class="va">ts_days</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">as_timestamp</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">ts_days</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "2023-01-01" "2023-01-02" "2023-01-03" "2023-01-04" "2023-01-05"</span></span>
<span><span class="co">#&gt;  [6] "2023-01-06" "2023-01-07" "2023-01-08" "2023-01-09" "2023-01-10"</span></span>
<span><span class="co">#&gt; [11] "2023-01-11" "2023-01-12" "2023-01-13" "2023-01-14" "2023-01-15"</span></span>
<span><span class="co">#&gt; [16] "2023-01-16" "2023-01-17" "2023-01-18" "2023-01-19" "2023-01-20"</span></span>
<span><span class="co">#&gt; [21] "2023-01-21" "2023-01-22" "2023-01-23" "2023-01-24" "2023-01-25"</span></span>
<span><span class="co">#&gt; [26] "2023-01-26" "2023-01-27" "2023-01-28" "2023-01-29" "2023-01-30"</span></span>
<span><span class="co">#&gt; [31] "2023-02-01" "2023-02-02" "2023-02-03" "2023-02-04" "2023-02-05"</span></span>
<span><span class="co">#&gt; [36] "2023-02-06" "2023-02-07" "2023-02-08" "2023-02-09" "2023-02-10"</span></span>
<span><span class="co">#&gt; [41] "2023-02-11" "2023-02-12" "2023-02-13" "2023-02-14" "2023-02-15"</span></span>
<span><span class="co">#&gt; [46] "2023-02-16" "2023-02-17" "2023-02-18" "2023-02-19" "2023-02-20"</span></span>
<span><span class="co">#&gt; [51] "2023-02-21" "2023-02-22" "2023-02-23" "2023-02-24" "2023-02-25"</span></span>
<span><span class="co">#&gt; [56] "2023-02-26" "2023-02-27" "2023-02-28" NA           NA</span></span></code></pre></div>
<p>31 January is missing from the vector of <code>Date</code>s because
the <code>360_day</code> calendar does not include it and 29 and 30
February are <code>NA</code>s because POSIXt rejects them. This will
produce problems later on when processing your data.</p>
<p>The general advice is therefore: <strong>do not convert CFTime
objects to Date objects</strong> unless you are sure that the
<code>CFTime</code> object uses a POSIXt-compatible calendar.</p>
<p>The degree of incompatibility for the various calendars is as
follows:</p>
<ul>
<li>
<code>standard</code>: Only valid for periods after 1582-10-15. The
preceeding period uses the Julian calendar.</li>
<li>
<code>julian</code>: Every fouth year is a leap year. Dates like
<code>2100-02-29</code> and <code>2200-02-29</code> are valid.</li>
<li>
<code>365_day</code> or <code>noleap</code>: No leap year exists.
<code>2020-02-29</code> does not occur.</li>
<li>
<code>366_day</code> or <code>all_leap</code>: All years are leap
years.</li>
<li>
<code>360_day</code>: All months have 30 days in every year. This
means that 31 January, March, May, July, August, October and December
never occur, while 29 and 30 February occur in every year.</li>
</ul>
</div>
<div class="section level5">
<h5 id="so-how-do-i-compare-climate-projection-data-with-different-calendars">So how do I compare climate projection data with different
calendars?<a class="anchor" aria-label="anchor" href="#so-how-do-i-compare-climate-projection-data-with-different-calendars"></a>
</h5>
<p>One reason to convert the time dimension from different climate
projection data sets is to be able to compare the data from different
models and produce a multi-model ensemble. The correct procedure to do
this is to first calculate <strong>for each data set
individually</strong> the property of interest (e.g. average daily
rainfall per month anomaly for some future period relative to a baseline
period), which will typically involve aggregation to a lower resolution
(such as from daily data to monthly averages), and only then combine the
aggregate data from multiple data sets to compute statistically
interesting properties (such as average among models and standard
deviation, etc).</p>
<p>Once data is aggregated from daily or higher-resolution values to a
lower temporal resolution - such as a “month” - the different calendars
no longer matter (although if you do need to convert averaged data
(e.g. average daily precipitation in a month) to absolute data
(e.g. precipitation per month) you should use
<code><a href="../reference/CFfactor_units.html">CFfactor_units()</a></code> to make sure that you use the correct
scaling factor).</p>
<p>Otherwise, there really shouldn’t be any reason to convert the time
series in the data files to <code>Date</code>s. Climate projection data
is virtually never compared on a day-to-day basis between different
models and neither does complex date arithmetic make much sense (such as
adding intervals) - <code>CFtime</code> can support basic arithmetic by
manipulation the offsets of the <code>CFTime</code> object. The
character representations that are produced are perfectly fine to use
for <code><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames()</a></code> on an array or as <code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames()</a></code> in
a <code>data.frame</code> and these also support basic logical
operations such as <code>"2023-02-30" &lt; "2023-03-01"</code>. So ask
yourself, do you really need <code>Date</code>s when working with
unprocessed climate projection data? (If so, <a href="https://github.com/R-CF/CFtime/issues" class="external-link">open an issue on
GitHub</a>).</p>
<p>A complete example of creating a multi-model ensemble is provided in
the vignette <a href="Processing.html">“Processing climate projection
data”</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="final-observations">Final observations<a class="anchor" aria-label="anchor" href="#final-observations"></a>
</h2>
<ul>
<li>This package is intended to facilitate processing of climate
projection data. It is a near-complete implementation of the CF Metadata
Conventions “time” component.</li>
<li>In parsing and deparsing of offsets and timestamps, data is rounded
to 3 digits of precision of the unit of the calendar. When using a
description of time that is very different from the calendar unit, this
may lead to some loss of precision due to rounding errors. For instance,
if milli-second precision is required, use a unit of “seconds”. The
authors have no knowledge of published climate projection data that
requires milli-second precision so for the intended use of the package
this issue is marginal.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Van Laake.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
